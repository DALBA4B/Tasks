<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ó–∞–¥–∞—á–∏">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%233b82f6' width='192' height='192'/><text x='50%' y='50%' font-size='120' fill='white' text-anchor='middle' dy='.35em' font-family='Arial,sans-serif' font-weight='bold'>‚úì</text></svg>">
    <title>–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/colors.css">
</head>
<body>
    <div class="container">
        <div class="top-nav">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="active">üìã –ó–∞–¥–∞—á–∏</button>
                <button class="nav-tab" data-tab="archive">üì¶ –ê—Ä—Ö–∏–≤</button>
                <button class="btn-add-task" id="btnAddTask" title="–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É">+</button>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
                <div class="sync-status offline" id="syncStatus">
                    <div class="sync-dot"></div>
                </div>
                <button class="btn-settings" id="btnSettings" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
            </div>
        </div>

        <div class="main-content">
            <div class="tasks-section">
                <div class="tasks-grid" id="tasksContainer"></div>
            </div>
        </div>
    </div>

    <!-- Storage Selection Modal (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ) -->
    <div class="modal" id="storageSelectionModal">
        <div class="modal-content modal-confirm" style="max-width: 450px;">
            <div class="modal-header">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</h3>
            </div>
            <p class="confirm-message" style="margin-bottom: 20px;">
                –ö–∞–∂–¥–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏, –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.
            </p>
            <div class="storage-selection-buttons">
                <button class="btn-storage" id="btnStorage1" data-storage="storage1">
                    <span style="font-size: 24px; margin-bottom: 8px; display: block;">üìÅ</span>
                    <strong>–•—Ä–∞–Ω–∏–ª–∏—â–µ 1</strong>
                </button>
                <button class="btn-storage" id="btnStorage2" data-storage="storage2">
                    <span style="font-size: 24px; margin-bottom: 8px; display: block;">üìÅ</span>
                    <strong>–•—Ä–∞–Ω–∏–ª–∏—â–µ 2</strong>
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <button class="modal-close" id="settingsModalClose">&times;</button>
            </div>
            <div style="padding: 15px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 15px;">
                    <div>
                        <p style="color: #6b7280; font-size: 13px; margin-bottom: 4px;">–•—Ä–∞–Ω–∏–ª–∏—â–∞:</p>
                        <p style="font-weight: 600; color: #1f2937;" id="currentStateDisplay">–†–∞–∑–¥–µ–ª–µ–Ω–æ</p>
                    </div>
                    <div class="storage-toggle-wrapper">
                        <input type="checkbox" id="storageToggle" class="storage-toggle-checkbox">
                        <label for="storageToggle" class="storage-toggle-label">
                            <span class="toggle-track"></span>
                            <span class="toggle-thumb"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                    <input type="text" id="editTitle" required minlength="1">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="editDescription"></textarea>
                </div>
                <div class="form-group">
                    <label>–î–µ–¥–ª–∞–π–Ω</label>
                    <input type="date" id="editDeadline">
                </div>
                <div class="form-group">
                    <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <select id="editPriority">
                        <option value="">–ë–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞</option>
                        <option value="low">–ù–∏–∑–∫–∏–π</option>
                        <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–°—Ç–∞—Ç—É—Å</label>
                    <select id="editStatus">
                        <option value="normal">–û–±—ã—á–Ω–∞—è</option>
                        <option value="in_work">–í —Ä–∞–±–æ—Ç–µ</option>
                        <option value="completed">–í—ã–ø–æ–ª–Ω–µ–Ω–∞</option>
                        <option value="archived">–ê—Ä—Ö–∏–≤–Ω–∞—è</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</label>
                    <input type="datetime-local" id="editCreatedAt">
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</label>
                    <input type="datetime-local" id="editInWorkAt">
                </div>
                <div class="form-group">
                    <label>–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                    <input type="datetime-local" id="editCompletedAt">
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn-cancel" id="cancelEdit">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</h3>
                <button class="modal-close" id="createModalClose">&times;</button>
            </div>
            <form id="createForm">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                    <input type="text" id="createTitle" required minlength="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="createDescription" placeholder="–î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏"></textarea>
                </div>
                <div class="form-group">
                    <label>–î–µ–¥–ª–∞–π–Ω</label>
                    <input type="date" id="createDeadline">
                </div>
                <div class="form-group">
                    <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                    <select id="createPriority">
                        <option value="">–ë–µ–∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞</option>
                        <option value="low">–ù–∏–∑–∫–∏–π</option>
                        <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn-save">–°–æ–∑–¥–∞—Ç—å</button>
                    <button type="button" class="btn-cancel" id="cancelCreate">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal" id="confirmDeleteModal">
        <div class="modal-content modal-confirm">
            <div class="modal-header">
                <h3>–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?</h3>
            </div>
            <p class="confirm-message">–ó–∞–¥–∞—á—É –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å.

            </p>
            <div class="modal-actions">
                <button class="btn-delete" id="confirmDeleteBtn">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn-cancel" id="cancelDeleteBtn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Confirm Complete Modal -->
    <div class="modal" id="confirmCompleteModal">
        <div class="modal-content modal-confirm">
            <div class="modal-header">
                <h3>–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É?</h3>
            </div>
            <p class="confirm-message">–ó–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ –∞—Ä—Ö–∏–≤.</p>
            <div class="modal-actions">
                <button class="btn-complete" id="confirmCompleteBtn">–î–∞, –∑–∞–≤–µ—Ä—à–∏—Ç—å</button>
                <button class="btn-cancel" id="cancelCompleteBtn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK v9 Compat (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ script —Ç–µ–≥) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <!-- Application Scripts (–ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω!) -->
    <script src="js/config.js"></script>
    <script src="js/storage-manager.js"></script>
    <script src="js/autosize.js"></script>
    
    <!-- Data Layer (IndexedDB + Sync) -->
    <script src="js/db.js"></script>
    <script src="js/offline-queue.js"></script>
    <script src="js/sync-engine.js"></script>
    
    <!-- UI Layer -->
    <script src="js/task.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/handlers.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => {
                    console.log('[App] Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
                    setInterval(() => {
                        registration.update();
                    }, 6 * 60 * 60 * 1000);
                })
                .catch(error => {
                    console.error('[App] –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
                });
        }
    </script>
    
    <!-- Application -->
    <script src="js/app.js"></script>
</body>
</html>

